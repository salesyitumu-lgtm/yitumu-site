---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';
import { assertLocale, pickByLocale } from './_util';

export async function getStaticPaths() {
  return ['en','es','fr','de','it'].map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params;
if (!lang || !assertLocale(lang)) throw new Error('Invalid lang');

const settings = (await getCollection('settings'))[0]?.data;

const ui = {
  blog: pickByLocale(settings ?? {}, lang, 'nav_blog') ?? 'Blog',
  about: pickByLocale(settings ?? {}, lang, 'nav_about') ?? 'About',
  contact: pickByLocale(settings ?? {}, lang, 'nav_contact') ?? 'Contact',
  langLabel: pickByLocale(settings ?? {}, lang, 'lang_label') ?? 'Language'
};

const catsAll = await getCollection('categories');
const nav = catsAll
  .filter(c => c.data.enabled)
  .sort((a,b)=> (a.data.order ?? 999) - (b.data.order ?? 999))
  .map(c => ({
    slug: c.slug,
    label: (c.data as any)[`name_${lang}`] ?? c.data.name_en,
    href: `/${lang}/${c.slug}/`
  }));
---

<Base title="YITUMU GLOBAL" lang={lang} nav={nav} settings={settings} ui={ui}>
  <section class="hero">
    <div class="grid">
      <div class="card">
        <h1>Wholesale Products &amp; OEM/ODM Support</h1>
        <p class="muted">
          Car chargers, USB fans, car accessories and home &amp; kitchen items. Fast response, stable supply, and quality control.
        </p>
        <p><a class="btn" href={`/${lang}/contact/`}>Request a Quote</a></p>

        <div class="hr"></div>

        <h2>Categories</h2>
        <p class="muted">
          {nav.map((c, i) => (
            <>
              <a href={c.href}>{c.label}</a>{i < nav.length - 1 ? ' · ' : ''}
            </>
          ))}
        </p>

        <div class="hr"></div>

        <h2>How to update products &amp; blog</h2>
        <p class="muted">
          Go to <a href="/admin/">/admin</a> → login → edit Categories / Products / Blog / Site Settings.
        </p>
      </div>
    </div>
  </section>
</Base>
